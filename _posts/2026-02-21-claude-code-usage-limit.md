---
title: "Claude Code の使用量上限とうまく付き合う方法"
emoji: "🧠"
type: "tech"
topics: ["claudecode", "claude", "ai", "効率化", "コスト削減"]
published: true
published_at: "2026-02-21 09:00"
---

## はじめに

Claude Code を Pro プランで使っていると「すぐ上限に達して使えなくなる」という問題にぶつかります。筆者もその一人です。

この記事では、プランの仕組みを正しく理解したうえで、使用量を意識した具体的な使い方をまとめます。

---

## プランと使用量制限の仕組み

### プラン比較（2025年時点）

| プラン | 価格 | 使用量の目安 |
|--------|------|-------------|
| Pro | $20/月 | ベースライン |
| Max 5x | $100/月 | Pro の 5 倍 |
| Max 20x | $200/月 | Pro の 20 倍 |

### 5時間のローリングウィンドウ制限

Pro/Max プランの使用量制限は「深夜0時リセット」ではなく、**最初のリクエストから5時間のローリングウィンドウ**で管理されます。つまり、1回のセッションで集中的に使うとあっという間に上限に到達します。

さらに、Claude.ai（Web・デスクトップ・モバイル）と Claude Code の使用量は**共有**されています。ブラウザで Claude を使った分も消費されるため注意が必要です。

### API キーの落とし穴

環境変数 `ANTHROPIC_API_KEY` が設定されている場合、Claude Code はサブスクリプションではなく **API の従量課金**で動作します。意図せず設定されていると、サブスクリプションとは別に課金が発生するため確認が必要です。

```bash
echo $ANTHROPIC_API_KEY  # 設定されているか確認
```

---

## 使用量を節約する具体的なテクニック

### 1. `/context` で現状を把握する

まずは現在のトークン消費量を把握することが重要です。

```
/context
```

システムプロンプト・会話履歴・CLAUDE.md・MCP ツールなどのカテゴリ別に使用量が表示されます。コンテキストが **83.5%（約167,000トークン）** に達すると自動コンパクションが発動するため、70% 手前で手動対応するのがおすすめです。

### 2. `/clear` と `/compact` を使いこなす

コンテキスト管理のコマンドが 2 つあり、使い分けが重要です。

| コマンド | 効果 | 使うタイミング |
|----------|------|--------------|
| `/clear` | 会話履歴を完全リセット | 別のタスクに切り替えるとき |
| `/compact` | 会話履歴を要約して圧縮 | 同じタスクを続けるが長くなりすぎたとき |

```
/compact 実装済みファイルのリストとテストコマンドを必ず保持すること
```

`/compact` はカスタム指示を渡すことで、重要な情報だけを引き継げます。

**`/clear` + CLAUDE.md の整備を組み合わせると、トークン使用量を 50〜70% 削減できる**という報告があります。

### 3. CLAUDE.md を充実させる

CLAUDE.md はセッション開始時に自動で読み込まれるプロジェクトメモリです。毎回 Claude に説明する手間が省けます。

重要なのは **5,000トークン以内に収める**ことです。長すぎると逆にコンテキストを圧迫します。書くべき内容の目安：

```markdown
# プロジェクト概要
[目的を2〜3行で]

# 技術スタック・コードスタイル

# アクセス禁止ディレクトリ
- node_modules/, .git/, dist/

# 現在の既知バグ・TODO
```

「クリーンなコードを書いてください」のような汎用的な指示は書かないほうがよいです。

### 4. 指示を具体的にする

漠然とした指示は Claude が余計なファイルを探索し、トークンを無駄遣いします。

```
# 悪い例
「このコードをよくして」

# 良い例
「src/auth.js の認証ロジックを修正してください。変更対象はこのファイルだけです」
```

`@` でファイルを直接指定するとより効果的です。

```
@src/auth.js の認証エラーを修正してください
```

### 5. タスクを小さく分割する

1 つのセッションで複数の無関係なタスクをまとめて処理しないことが鉄則です。

```
# 悪い例（1セッションで全部やろうとする）
「認証バグを直して、UIも改善して、テストも書いて」

# 良い例（分割する）
セッション1：「auth.js の認証バグを修正」→ /clear
セッション2：「LoginForm の UI 改善」→ /clear
セッション3：「認証モジュールのテスト追加」
```

1セッションの目標を **30,000トークン以内**に収めることを意識すると自動コンパクションも避けられます。

### 6. モデルを使い分ける

Claude Code はデフォルト Sonnet ですが、タスクに応じてモデルを切り替えることでコストを削減できます。

```
/model claude-haiku-4-5    # 軽量タスク用（Sonnet の 1/3 のコスト）
/model claude-sonnet-4-6   # 通常のコーディング（デフォルト）
/model claude-opus-4-6     # 複雑な設計・推論
```

| モデル | 用途の目安 |
|--------|-----------|
| Haiku | ドキュメント生成・シンプルなバグ修正・繰り返しタスク |
| Sonnet | 日常的なコーディング（8割はこれ） |
| Opus | アーキテクチャ設計・複雑な推論 |

### 7. `--max-turns` で暴走を防ぐ

Claude が際限なくツールコールを繰り返すことがあります。`--max-turns` で上限を設定しておくと安全です。

```bash
claude --max-turns 10
```

---

## 使用量を確認するツール

### ccusage（CLI ツール）

Claude Code がローカルに保存する JSONL ファイルを解析して、トークン使用量とコストを集計してくれます。

```bash
npx ccusage          # 概要
npx ccusage daily    # 日別使用量
npx ccusage monthly  # 月別使用量
npx ccusage blocks   # 5時間ウィンドウ別
```

モデル別の使用量内訳も確認でき、「どのモデルに一番使っているか」が一目でわかります。インストール不要で `npx` でそのまま実行できる点も便利です。

---

## 推奨ワークフロー

以上をまとめると、以下の流れで作業するのが効率的です。

1. **CLAUDE.md を最新に保つ**（5,000トークン以内）
2. **具体的な指示でセッション開始**（スコープを明確に）
3. **`/context` で定期的にトークン残量を確認**
4. **コンテキストが 70% に達したら手動で `/compact`**
5. **タスク完了・別タスクに切り替えるときは `/clear`**
6. **週次で `ccusage` でトレンドを分析**

---

## まとめ

Claude Code の使用量問題は、仕組みを理解して適切にコンテキストを管理することで大幅に改善できます。特に効果が大きいのは次の 3 点です。

- **`/clear` の積極活用**：タスク完了ごとにリセット
- **CLAUDE.md の整備**：毎回の説明コストをゼロに
- **`ccusage` で可視化**：使用量の傾向を把握して行動を変える

これらを組み合わせることで、Pro プランでも上限に達しにくい使い方ができるようになります。

## 参考リンク

- [Claude Code 公式ドキュメント - コスト管理](https://code.claude.com/docs/en/costs)
- [Claude Code ベストプラクティス](https://code.claude.com/docs/en/best-practices)
- [ccusage - GitHub](https://github.com/ryoppippi/ccusage)
- [Claude Max プランとは？](https://support.claude.com/en/articles/11049741-what-is-the-max-plan)
