---
layout: post
title: "Claude Code のAgent Teamsで複数AIが協調するチームを作ろう"
img_path: /assets/img/logos
image:
  path: logo-only.svg
  width: 100%
  height: 100%
  alt: Zenn
category: [Tech]
tags: ["claudecode", "claude", "ai", "agentteams", "効率化"]
date: "2026-02-23 10:00"
---


---

この記事は[Zenn](https://zenn.dev/long910/articles/2026-02-23-claude-code-agent-teams)でも公開しています。


「大きなタスクを複数のAIに並行して任せたい」──Claude Code の **Agent Teams** はまさにそれを実現する機能です。

通常の Claude Code は1つのAIが順番に作業を進めますが、Agent Teams を使うと**複数のClaudeが同時に動いてお互いに会話しながら作業を進める**ことができます。

さらに **tmux（ターミナルマルチプレクサー）** と組み合わせると、各エージェントの作業を別々のペインでリアルタイムに監視できる「スプリットペインモード」が使えるようになります。複数のAIが画面に並んで同時に動く様子はなかなか壮観です。

まだ実験的な機能（2026年2月時点）ですが、概念から tmux との組み合わせまで詳しくまとめました。

---

## Agent Teams とは

Agent Teams は、**複数の Claude Code インスタンスを1つのチームとして協調させる**機能です。

それぞれのエージェント（チームメンバー）が独立したコンテキストウィンドウを持ち、専門領域に特化した作業を並行して行いながら、必要に応じてお互いにメッセージを送り合えます。

### 通常のサブエージェントとの違い

Claude Code にはすでに「サブエージェント」の仕組みがありましたが、Agent Teams はそれとは別物です。

| 比較項目 | サブエージェント | Agent Teams |
|---|---|---|
| **独立性** | 結果をメインに返すだけ | 完全に独立して動く |
| **コミュニケーション** | メインに報告するだけ | チームメンバー同士が直接会話 |
| **タスク管理** | メインが全部指示 | 共有タスクリストで自律的に分担 |
| **向いている用途** | 単発の集中タスク | 議論・調査・並行実装 |
| **トークンコスト** | 低め | 高め（全員分の文脈がかかる） |

**シンプルな例え**：
- サブエージェント → 「調べてきて」と部下に頼んで結果だけもらう
- Agent Teams → チームで会議をしながら複数人が同時に作業を進める

---

## 前提・有効化の方法

### 前提条件

- Claude Code がインストール済みであること
- **実験的機能のため、デフォルトでは無効**
- スプリットペインモードを使う場合は **tmux** が必要（後述）

### 有効化する3つの方法

**方法1：環境変数で有効化（一時的に試したいとき）**

```bash
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
claude
```

**方法2：設定ファイルで有効化（常に使いたいとき）**

`~/.claude/settings.json` に以下を追記：

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

**方法3：コマンドラインフラグ**

```bash
claude --experimental-agent-teams
```

有効化すると、Claude Code のチャットで「チームを作って」と言うだけでAgent Teamsが使えるようになります。

---

## Agent Teams の構成要素

```
┌─────────────────────────────────────┐
│          チームリード（自分）          │
│  メインの Claude Code セッション      │
└────────────┬────────────────────────┘
             │ チームを生成・調整
    ┌────────┼────────┐
    ▼        ▼        ▼
┌───────┐ ┌───────┐ ┌───────┐
│ 担当A │⇄│ 担当B │⇄│ 担当C │  チームメンバー
│（別AI）│ │（別AI）│ │（別AI）│
└───────┘ └───────┘ └───────┘
    ↑            ↑
  共有タスクリスト・共有メールボックス
```

| 役割 | 説明 |
|---|---|
| **チームリード** | チームを生成・調整する主セッション（あなたが対話する） |
| **チームメンバー** | 独立して動く Claude のインスタンス |
| **共有タスクリスト** | 全員が参照・担当できる作業リスト |
| **メールボックス** | エージェント間のメッセージ送受信機能 |

---

## 初めてのAgent Teams

有効化したら、自然言語でチームを指示するだけです。

```
CLIツールのリファクタリングを並行して進めたい。
以下3名のチームメンバーを作ってください：
- アーキテクト：設計方針を策定する
- 実装者：コードを書く
- レビュアー：コードの品質チェックをする
```

Claude が：
1. チームを作成
2. 指定した役割でメンバーをスポーン
3. タスクを割り振って並行実行開始
4. 完了したら結果を統合

という流れで自動的に動いてくれます。

---

## 表示モードと操作方法

Agent Teams には2種類の表示モードがあります。まず違いを把握してから、どちらを使うか選んでください。

### インプロセスモード（デフォルト）

tmux なしで使える手軽なモードです。全チームメンバーがメインターミナルの中で動き、キー操作で切り替えながら確認します。

| キー操作 | 効果 |
|---|---|
| `Shift + ↓` | チームメンバーを順番に切り替える |
| `Enter` | 選択したメンバーのセッションに入る |
| `Escape` | 実行中のターンを中断する |
| `Ctrl + T` | 共有タスクリストの表示/非表示 |

**向いている場面**：手軽に試したい、メンバーが2〜3人の小規模チーム

### スプリットペインモード（tmux 推奨）

各メンバーが独立したペインで動き、**全員の作業を同時にリアルタイムで確認**できます。tmux または iTerm2 が必要です。

```
┌────────────────┬────────────────┬────────────────┐
│  チームリード   │    担当A        │    担当B        │
│               │                │                │
│ タスクを指示中  │ src/auth/ を   │ src/api/ を    │
│               │ 実装中...       │ 実装中...       │
│               │                │                │
├────────────────┴────────────────┴────────────────┤
│    担当C（テスト）                                  │
│    テストケースを書き中...                           │
└─────────────────────────────────────────────────┘
```

**向いている場面**：メンバーが多い、全員の進捗を常に把握したい、並行実装のデバッグ

:::message
スプリットペインモードは macOS/Linux の tmux または iTerm2 が必要です。VS Code 統合ターミナルや Windows Terminal では現在非対応です。
:::

---

## tmux × Agent Teams：スプリットペインモードの使い方

### tmux とは？（インストールは既存記事を参照）

tmux は「1つのターミナルを複数のペインに分割して同時に使える」ツールです。インストール方法や基本操作は以下の記事で詳しく解説しています。

https://zenn.dev/long910/articles/2025-06-04-tmux

この記事では Agent Teams との組み合わせに絞って説明します。

### tmux のインストール（最低限）

**macOS：**
```bash
brew install tmux
```

**Ubuntu / WSL：**
```bash
sudo apt-get install tmux
```

インストール確認：
```bash
tmux -V
# tmux 3.x が表示されればOK
```

### なぜ tmux との組み合わせが強力なのか

| | インプロセスモード | tmux スプリットペインモード |
|---|---|---|
| **視認性** | 1人ずつしか見えない | 全員が同時に見える |
| **操作** | キーで順番切り替え | 任意のペインをクリックして直接入力 |
| **進捗把握** | 能動的に切り替えが必要 | 画面を見るだけでわかる |
| **割り込み** | Escape で中断 | ペインに直接メッセージを打てる |
| **セッション保存** | ターミナル終了で消える | tmux セッションとして残せる |

特に大きいのは**全員の画面が同時に見える**点です。3人のエージェントが並行して動いている様子を一画面で把握できるので、問題が起きたときにすぐ気づけます。

### スプリットペインモードの設定と起動

**設定ファイルで有効化（`~/.claude/settings.json`）：**

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  },
  "teammateMode": "split-pane"
}
```

**起動方法（tmux セッション内から）：**

```bash
# 1. tmux セッションを開始（必ずtmux内で起動すること）
tmux new -s agent-team

# 2. tmux 内で Claude Code を起動
claude --experimental-agent-teams --teammate-mode split-pane

# または settings.json に書いてあれば
claude --experimental-agent-teams
```

:::message alert
スプリットペインモードは **tmux セッションの中から** Claude Code を起動する必要があります。tmux を起動せずに普通のターミナルで起動するとエラーになります。
:::

### 実際の起動フロー（ステップバイステップ）

```bash
# ① まず tmux セッションを作る
tmux new -s myteam

# ② tmux の中で Claude Code を起動
claude --experimental-agent-teams

# ③ Claude に自然言語でチームを作るよう指示
```

```
（Claude Codeのチャット画面で）

以下の3名のチームで src/ ディレクトリのコードレビューをしてください：
- セキュリティ担当：認証・認可・入力検証を確認
- パフォーマンス担当：ボトルネック・N+1・メモリリークを確認
- テスト担当：テストカバレッジ・エッジケースを確認

スプリットペインモードで起動してください。
```

④ Claude がチームを生成すると、tmux のペインが自動的に分割されて各エージェントが起動します

```
┌──────────────────────┬──────────────────────┐
│ Claude（リード）       │ セキュリティ担当      │
│                      │                      │
│ チームを生成しました。  │ src/auth/ を解析中    │
│ 各担当が調査を開始し  │ JWTの検証ロジックに   │
│ ます。               │ 問題発見...           │
├──────────────────────┼──────────────────────┤
│ パフォーマンス担当     │ テスト担当            │
│                      │                      │
│ クエリのN+1問題を     │ カバレッジを計測中...  │
│ 検出中...             │ 3ファイルが未テスト   │
└──────────────────────┴──────────────────────┘
```

### スプリットペインモードでの操作

**ペイン間の移動（tmux 標準操作）：**

| 操作 | 効果 |
|---|---|
| `Ctrl+b` → 矢印キー | 隣のペインに移動 |
| `Ctrl+b q` → ペイン番号 | 指定ペインにジャンプ |
| マウスクリック（マウスモード有効時） | そのペインをアクティブに |

**エージェントに直接話しかける：**

移動先のペインで直接テキストを入力するだけで、そのエージェントへの指示になります。

```bash
# ペインを切り替えてセキュリティ担当に直接指示
（Ctrl+b → 右矢印でペイン移動）
「src/api/user.ts の認証チェックを最優先で見て」
```

**全体のタスクリスト確認：**

リードのペインで `Ctrl + T` を押すと共有タスクリストが表示されます。

### tmux セッションの保存と再接続

長時間の作業では tmux のセッション永続化が役立ちます。

```bash
# セッションから一時離脱（デタッチ）
Ctrl+b d

# 後で再接続
tmux attach -t myteam
```

ただし現時点では **インプロセスのチームメンバーはセッション再開で復元されません**。デタッチ・アタッチはリードとの確認作業のタイミングで活用してください。

### tmux の推奨設定（Agent Teams 向け）

`~/.tmux.conf` に以下を追加しておくと、Agent Teams が使いやすくなります。

```bash
# マウスで直接ペインをクリック・スクロールできる
set -g mouse on

# ペイン間をCtrl+矢印でも移動できる
bind -n C-Left select-pane -L
bind -n C-Right select-pane -R
bind -n C-Up select-pane -U
bind -n C-Down select-pane -D

# ステータスバーにセッション名を表示
set -g status-left "#[fg=cyan][#S] "

# ペインに番号を表示しやすくする
set -g display-panes-time 3000
```

設定を反映：
```bash
tmux source-file ~/.tmux.conf
```

詳しい tmux のカスタマイズは[TMUX入門記事](https://zenn.dev/long910/articles/2025-06-04-tmux)を参照してください。

---

## タスク管理の仕組み

Agent Teams ではチームメンバーが**共有タスクリスト**を使って自律的に作業を進めます。

### タスクの状態

```
pending → in_progress → completed
```

- **pending**: 未着手（誰でも担当できる）
- **in_progress**: 誰かが担当中
- **completed**: 完了

### タスクの依存関係

タスク間に依存関係を設定できます。例えば「APIを作ってからフロントエンドを作る」といった順序が必要なケースです。

```
タスク1: バックエンドAPIの実装
タスク2: フロントエンドの実装（タスク1が完了するまで開始不可）
タスク3: テストの実装（タスク1・2が完了するまで開始不可）
```

依存元が完了すると、ブロックされていたタスクが自動的にアンロックされます。

### タスクの担当

```
# リードがタスクを特定のメンバーに割り当てる
「バックエンドAPIの実装タスクはアーキテクトに任せて」

# メンバーが自律的にタスクを選ぶ（自動でクレームして進める）
「終わったら次のタスクを自分でピックアップして進めてください」
```

---

## チームメンバーへの直接指示

### 特定のメンバーに話しかける

```
セキュリティレビュアーに「認証モジュールの確認を優先して」と伝えて
```

### 計画の承認を求める

複雑な変更を行う前に、メンバーに計画を立てさせてから承認できます。

```
アーキテクトに認証モジュールのリファクタリングを依頼して。
変更前に必ず計画を提出させて、承認してから実装させてください。
```

流れ：
1. メンバーが読み取り専用モードで計画を作成
2. リードに承認リクエストを送信
3. リードが確認して承認 or 差し戻し
4. 承認されたらメンバーが実装を開始

---

## メンバー間のコミュニケーション

Agent Teams の核心は「AIどうしが直接会話できる」点です。

### メンバー間でメッセージを送り合う

```
バックエンド担当に「APIのエンドポイント設計が固まったらフロントエンド担当に共有して」と伝えて
```

### 全員にブロードキャスト

```
全メンバーに「テストは Jest で書くこと」をブロードキャストして
```

:::message alert
ブロードキャストはすべてのメンバーのコンテキストに送られるのでコスト大。本当に全員に必要な情報だけ使いましょう。
:::

---

## メンバーのシャットダウンとクリーンアップ

### 特定のメンバーを終了する

```
リサーチャーのセッションを終了して
```

メンバーは終了リクエストを承認 or 「まだ作業中なので続けさせてほしい」と断ることもできます。

### チーム全体をクリーンアップ

作業完了後はリソースを解放します。

```
チームをクリーンアップして
```

:::message alert
クリーンアップは**必ずリードから**行ってください。メンバーがクリーンアップしようとするとチームコンテキストの解決に問題が起きることがあります。
:::

---

## Agent Teams が向いている用途・向いていない用途

### 向いている用途

**1. 調査・レビュー系（特に得意）**

```
PR #142 を3つの観点でレビューするチームを作って：
- セキュリティの観点（担当A）
- パフォーマンスへの影響（担当B）
- テストの網羅性（担当C）
それぞれが独立してレビューした後、意見を突き合わせて総合評価をまとめて
```

**2. 並行実装（担当領域が被らない場合）**

```
以下の4モジュールを並行実装して：
- 担当1: 認証モジュール（src/auth/）
- 担当2: APIエンドポイント（src/api/）
- 担当3: データベーススキーマ（src/db/）
- 担当4: テストスイート（src/tests/）
```

**3. 競合する仮説の同時検証**

```
アプリが1メッセージ後に落ちるバグを調査したい。
5つの仮説を並行して検証するチームを作って。
それぞれが証拠を集めて、互いに反論し合いながら絞り込んで。
```

**4. フロントエンド/バックエンド/テストの横断的変更**

一つの機能追加がUI・API・DBに及ぶような場合、各レイヤーの担当者が並行して動くと効率的です。

### 向いていない用途

- **単純な1回限りのタスク** → 通常のClaude Codeで十分
- **小さすぎるタスク** → チーム立ち上げのオーバーヘッドが損
- **ファイルが重複するタスク** → 同じファイルを複数人が編集すると上書きが発生
- **コスト重視の場合** → 各メンバーが独立したコンテキストを持つのでトークン消費が大きい

---

## ベストプラクティス

### 1. メンバーに豊富なコンテキストを与える

メンバーはリードの会話履歴を引き継ぎません。スポーン時に必要な情報をすべて渡します。

```
# 悪い例
「セキュリティレビューをやって」

# 良い例
「src/auth/ の認証モジュールをセキュリティ観点でレビューして。
アプリはJWTトークンをhttpOnlyクッキーに保存している。
特にトークンの検証ロジック、セッション管理、入力値の検証を重点的に確認して。
問題には重要度（高/中/低）をつけてレポートしてください。」
```

### 2. タスクの粒度を適切に保つ

- **小さすぎる**：1メンバーにタスクが5分で終わるような量 → チームのオーバーヘッドが無駄
- **大きすぎる**：1メンバーが何時間も動きっぱなし → 進捗確認できない
- **ちょうどいい**：1担当が30分〜2時間で完了する単位が目安

1メンバーあたり5〜6タスクを目安に設計すると効率的です。

### 3. ファイルの衝突を避ける

2人が同じファイルを同時に編集すると上書きが発生します。

```
# 悪い設計
担当A: src/utils.ts を修正
担当B: src/utils.ts を修正（同時）→ 片方の変更が消える

# 良い設計
担当A: src/utils/formatter.ts を担当
担当B: src/utils/validator.ts を担当（別ファイル）
```

同じファイルを触る必要がある場合は、タスク間に依存関係を設定して順番に処理させます。

### 4. 定期的に進捗を確認する

放置すると無駄な方向に進んでしまうことがあります。

```
「各メンバーの進捗を教えて」
「バックエンド担当の現在の状況を確認して」
```

### 5. まずは調査・レビューから始める

初めて使う場合は、実装よりも「調査」や「PRレビュー」から試すのがおすすめです。ファイル衝突のリスクがなく、並行作業のメリットがわかりやすいです。

---

## 現在の制限事項（2026年2月時点）

実験的機能なので、いくつか制限があります。

| 制限 | 詳細 |
|---|---|
| セッション再開できない | `/resume` や `/rewind` でインプロセスのメンバーは復元されない |
| タスク状態の遅延 | メンバーがタスク完了をマークし忘れることがある |
| シャットダウンが遅い | 現在の処理が終わってからシャットダウン |
| 1セッションに1チームのみ | リードは1チームしか管理できない |
| ネストしたチーム不可 | メンバーが自分のチームを作ることはできない |
| リードは固定 | チームを作ったセッションが常にリード（昇格不可） |
| スプリットペインの制限 | tmux / iTerm2 が必要。VS Code / Windows Terminal 非対応 |

---

## まとめ

| ポイント | 内容 |
|---|---|
| 何ができる | 複数のAIが並行作業・直接会話してタスクを進める |
| 有効化 | `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` |
| tmux なしで使う | インプロセスモード（デフォルト）でキー操作切り替え |
| tmux と組み合わせる | スプリットペインモードで全員の画面を同時表示 |
| 向いている用途 | 調査、レビュー、領域が被らない並行実装 |
| 注意点 | トークンコストが高い、ファイル衝突に注意 |
| 現状 | 実験的機能（2026年2月時点） |

### クイックスタートまとめ

```bash
# 1. tmux のインストール（macOS）
brew install tmux

# 2. tmux セッションを開始
tmux new -s agent-team

# 3. Agent Teams を有効化して Claude Code 起動
CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1 claude

# 4. Claude に指示するだけ
# 「3名のチームで〇〇のレビューをしてください」
```

個人的には、まず tmux を使ったスプリットペインモードでのPRレビューから試してみたいと思っています。「セキュリティ担当」「パフォーマンス担当」「テスト担当」が各ペインで同時に動く画面を眺めながら、必要に応じて直接話しかけられる──という体験は通常の Claude Code とはかなり違った感覚になりそうです。

実験的機能なので今後も仕様が変わる可能性がありますが、ぜひ試してみてください。

---

## 参考リンク

- [Claude Code Agent Teams 公式ドキュメント](https://code.claude.com/docs/en/agent-teams)
- [Claude Code Subagents ドキュメント](https://code.claude.com/docs/en/sub-agents)
- [TMUX入門記事（インストール・基本操作）](https://zenn.dev/long910/articles/2025-06-04-tmux)
